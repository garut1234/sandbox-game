<!DOCTYPE html>
<html>
<head>
    <title>Sandbox - Full Command Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }

        /* CHAT LOG BOX */
        #chatBox {
            position: fixed; bottom: 180px; left: 20px; width: 380px; height: 200px;
            background: rgba(0, 0, 0, 0.6); border-radius: 12px; padding: 12px;
            color: white; overflow-y: auto; display: none; z-index: 3500;
            font-size: 14px; border: 1px solid rgba(255,255,255,0.2);
            scrollbar-width: thin;
        }
        .chat-line { margin-bottom: 5px; word-wrap: break-word; text-shadow: 1px 1px 1px black; }

        /* GLOBAL MESSAGE BAR */
        #globalBar {
            position: fixed; top: 15px; left: 50%; transform: translateX(-50%);
            width: 70%; padding: 10px; background: rgba(255, 165, 0, 0.9);
            color: black; font-weight: bold; text-align: center; border-radius: 10px;
            display: none; z-index: 4000; border: 2px solid #ffd700;
        }

        /* LOGIN SCREEN */
        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1a1a1a; display: flex; justify-content: center; align-items: center; z-index: 5000; color: white;
        }
        .login-box { text-align: center; background: #333; padding: 40px; border-radius: 20px; border: 2px solid #555; }
        input#nameInput { padding: 12px; width: 250px; border-radius: 8px; border: none; text-align: center; }
        button#startBtn { padding: 12px 40px; margin-top: 15px; background: #00ff00; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* INPUT CHAT */
        #chatInput {
            position: fixed; bottom: 130px; left: 20px; width: 380px; padding: 12px;
            background: rgba(0,0,0,0.8); color: white; border: 2px solid #00ff00;
            border-radius: 10px; display: none; z-index: 4000; outline: none;
        }

        @keyframes nukeShake { 0% { transform: translate(0,0); } 25% { transform: translate(-5px,5px); } 50% { transform: translate(5px,-5px); } 100% { transform: translate(0,0); } }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h1>SANDBOX COMMANDS</h1>
        <p id="lockStatus" style="color: #00ff00;">World Status: Online</p>
        <input type="text" id="nameInput" placeholder="Masukkan Nama..." maxlength="15">
        <br>
        <button id="startBtn">PLAY</button>
    </div>
</div>

<div id="globalBar">GLOBAL: Selamat datang di server!</div>
<div id="chatBox"></div>
<input type="text" id="chatInput" placeholder="Ketik command atau chat...">

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const chatInput = document.getElementById("chatInput");
    const chatBox = document.getElementById("chatBox");
    const globalBar = document.getElementById("globalBar");

    let gameStarted = false;
    let playerName = "";
    let playerRole = localStorage.getItem("playerRole") || "PLAYER";
    let worldIsNuked = localStorage.getItem("worldNuked") === "true";
    let isMuted = false;

    // Cek Status World di Lobi
    if(worldIsNuked) {
        document.getElementById("lockStatus").innerText = "World Status: NUKED/LOCKED ⚠️";
        document.getElementById("lockStatus").style.color = "red";
    }

    document.getElementById("startBtn").onclick = () => {
        const name = document.getElementById("nameInput").value.trim();
        const isAdmin = (playerRole === "DEV" || playerRole === "MOD");
        
        if(!name) return alert("Isi nama dulu!");
        if(worldIsNuked && !isAdmin) return alert("Gagal masuk: World sedang di-ban oleh Admin!");

        playerName = name;
        document.getElementById("loginScreen").style.display = "none";
        chatBox.style.display = "block";
        globalBar.style.display = "block";
        gameStarted = true;
        addLog("System", "Ketik /? untuk melihat daftar command.", "#aaa");
    };

    function addLog(sender, msg, color = "white") {
        const div = document.createElement("div");
        div.className = "chat-line";
        div.style.color = color;
        div.innerHTML = `<strong>${sender}:</strong> ${msg}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function processCommand(input) {
        if (!input.startsWith("/")) {
            if(isMuted) return addLog("System", "Anda sedang di-mute!", "red");
            addLog(playerName, input, (playerRole === "DEV" ? "#00ffff" : "white"));
            return;
        }

        const args = input.split(" ");
        const cmd = args[0].toLowerCase();
        const isAdmin = (playerRole === "DEV" || playerRole === "MOD");

        switch(cmd) {
            case "/?":
                addLog("Help", "/gm [msg], /p [nama] [msg], /nuked, /muteplayer, /iamdeveloper [kode]", "#00ff00");
                break;
            
            case "/gm":
                const gmMsg = args.slice(1).join(" ");
                globalBar.innerText = `GLOBAL [${playerName}]: ${gmMsg}`;
                addLog("GLOBAL", gmMsg, "#ffd700");
                break;

            case "/p":
                const target = args[1];
                const pMsg = args.slice(2).join(" ");
                addLog(`PRIVATE to ${target}`, pMsg, "#ff00ff");
                break;

            case "/nuked":
                if(!isAdmin) return addLog("System", "Hanya DEV/MOD!", "red");
                worldIsNuked = !worldIsNuked;
                localStorage.setItem("worldNuked", worldIsNuked);
                globalBar.innerText = worldIsNuked ? "☢️ WORLD HAS BEEN NUKED & LOCKED" : "✅ WORLD UNLOCKED";
                canvas.style.animation = "nukeShake 0.5s";
                setTimeout(() => canvas.style.animation = "", 500);
                break;

            case "/muteplayer":
                if(!isAdmin) return addLog("System", "Hanya DEV/MOD!", "red");
                isMuted = !isMuted;
                addLog("System", "Status Mute: " + isMuted, "orange");
                break;

            case "/setrole":
                if(playerRole !== "DEV") return addLog("System", "Hanya DEV!", "red");
                playerRole = args[1].toUpperCase();
                localStorage.setItem("playerRole", playerRole);
                location.reload();
                break;

            case "/iamdeveloper":
                if(args[1] === "1234") { // Kode rahasia
                    playerRole = "DEV";
                    localStorage.setItem("playerRole", "DEV");
                    addLog("System", "Role Developer diaktifkan!", "#00ffff");
                    setTimeout(() => location.reload(), 1000);
                } else {
                    addLog("System", "Kode salah!", "red");
                }
                break;

            default:
                addLog("System", "Command tidak dikenal.", "#ff4444");
        }
    }

    // Input & Game Loop
    window.onkeydown = (e) => {
        if(!gameStarted) return;
        if(e.code === "Enter") {
            if(chatInput.style.display === "none") {
                chatInput.style.display = "block"; chatInput.focus();
            } else {
                if(chatInput.value) processCommand(chatInput.value);
                chatInput.value = ""; chatInput.style.display = "none";
            }
        }
        if(chatInput.style.display === "none") keys[e.code] = true;
    };
    window.onkeyup = (e) => keys[e.code] = false;
    let keys = {};

    const tileSize = 40;
    let player = { x: 100, y: 100, w: 30, h: 40, vy: 0 };

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(!gameStarted) { requestAnimationFrame(draw); return; }
        
        // Gambar Tanah Sederhana
        ctx.fillStyle = "#8B4513";
        ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

        // Gambar Player
        ctx.fillStyle = "#FFD700";
        ctx.fillRect(player.x, player.y, player.w, player.h);
        
        // Label Nama & Role
        ctx.fillStyle = (playerRole === "DEV") ? "#00ffff" : "white";
        ctx.textAlign = "center";
        ctx.fillText(`[${playerRole}] ${playerName}`, player.x + 15, player.y - 10);

        // Gerakan Sederhana
        if(keys["KeyA"]) player.x -= 5;
        if(keys["KeyD"]) player.x += 5;
        
        requestAnimationFrame(draw);
    }

    window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    draw();
</script>
</body>
</html>
