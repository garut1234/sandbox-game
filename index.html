<!DOCTYPE html>
<html>
<head>
    <title>Sandbox Pro - Persistent Inventory</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }

        /* TOP CHAT SYSTEM - Muncul saat chat/ada pesan */
        #topChatContainer {
            position: fixed; top: 0; left: 0; width: 100%;
            display: none; flex-direction: column; z-index: 4500;
        }
        #globalBar {
            width: 100%; padding: 12px 0; background: rgba(255, 165, 0, 0.95);
            color: #000; font-weight: bold; text-align: center; 
            border-bottom: 2px solid #ffd700; font-size: 16px;
        }
        #chatBox {
            width: 100%; max-height: 120px; background: rgba(0, 0, 0, 0.5);
            color: white; overflow-y: auto; padding: 5px 0;
            font-size: 14px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2);
            scrollbar-width: none;
        }
        #chatBox::-webkit-scrollbar { display: none; }
        .chat-line { margin-bottom: 4px; text-shadow: 1px 1px 2px black; }

        /* INPUT CHAT CENTER */
        #chatInput {
            position: fixed; top: 180px; left: 50%; transform: translateX(-50%);
            width: 400px; padding: 12px; background: rgba(0,0,0,0.85); 
            color: white; border: 2px solid #00ff00; border-radius: 25px;
            display: none; z-index: 4600; outline: none; text-align: center;
        }

        /* INVENTORY / HOTBAR - SEKARANG DISPLAY: FLEX (SELALU MUNCUL) */
        #hotbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; background: rgba(0, 0, 0, 0.7); padding: 10px;
            border-radius: 15px; border: 3px solid #444; z-index: 2000;
            flex-direction: row; gap: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        .slot {
            width: 55px; height: 55px; background: #333; border: 2px solid #666;
            border-radius: 10px; display: flex; justify-content: center; 
            align-items: center; color: #fff; font-weight: bold; font-size: 10px;
            position: relative; cursor: pointer; transition: 0.2s;
        }
        .slot.active { border-color: #00ff00; background: #444; box-shadow: 0 0 10px #00ff00; transform: scale(1.1); }
        .slot::after { content: attr(data-key); position: absolute; top: 2px; left: 5px; font-size: 12px; color: #00ff00; }

        /* LOGIN */
        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; display: flex; justify-content: center; align-items: center; z-index: 5000; color: white;
        }
        .login-box { text-align: center; background: #222; padding: 40px; border-radius: 25px; border: 2px solid #00ff00; }
        input#nameInput { padding: 12px; width: 250px; border-radius: 8px; border: none; text-align: center; outline: none; font-size: 16px; }
        button#startBtn { padding: 12px 40px; margin-top: 20px; background: #00ff00; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h1 style="color: #00ff00; letter-spacing: 2px;">SANDBOX PRO</h1>
        <input type="text" id="nameInput" placeholder="Siapa namamu?" maxlength="15">
        <br><button id="startBtn">MASUK DUNIA</button>
    </div>
</div>

<div id="topChatContainer">
    <div id="globalBar">DUNIA ONLINE</div>
    <div id="chatBox"></div>
</div>

<input type="text" id="chatInput" placeholder="Ketik pesan atau /cmd...">

<div id="hotbar">
    <div class="slot active" data-key="1">BRICK</div>
    <div class="slot" data-key="2">DIRT</div>
    <div class="slot" data-key="3">GRASS</div>
    <div class="slot" data-key="4">WOOD</div>
    <div class="slot" data-key="5">LEAF</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const chatInput = document.getElementById("chatInput");
    const chatBox = document.getElementById("chatBox");
    const globalBar = document.getElementById("globalBar");
    const topContainer = document.getElementById("topChatContainer");

    let gameStarted = false;
    let playerName = "";
    let playerRole = localStorage.getItem("playerRole") || "PLAYER";
    let hue = 0; 
    let ghostMode = false;
    let keys = {};
    let player = { x: 100, y: 100, w: 30, h: 40, vy: 0, speed: 5, jumpPower: -12 };

    document.getElementById("startBtn").onclick = () => {
        const inputName = document.getElementById("nameInput").value.trim();
        if(!inputName) return;
        playerName = inputName;
        document.getElementById("loginScreen").style.display = "none";
        gameStarted = true;
        addLog("Server", `Selamat datang ${playerName}!`, "#00ff00");
    };

    function addLog(sender, msg, color = "white") {
        const div = document.createElement("div");
        div.className = "chat-line";
        div.style.color = color;
        div.innerHTML = `<strong>${sender}:</strong> ${msg}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
        
        topContainer.style.display = "flex";
        // Jika tidak sedang mengetik, sembunyikan chat atas setelah 7 detik
        if(chatInput.style.display === "none") {
            clearTimeout(window.chatTimeout);
            window.chatTimeout = setTimeout(() => { 
                if(chatInput.style.display === "none") topContainer.style.display = "none"; 
            }, 7000);
        }
    }

    function toggleChat(show) {
        if(show) {
            topContainer.style.display = "flex";
            chatInput.style.display = "block";
            chatInput.focus();
        } else {
            chatInput.style.display = "none";
            // Chat box tetap muncul sebentar lalu hilang lewat timer di addLog
            clearTimeout(window.chatTimeout);
            window.chatTimeout = setTimeout(() => { 
                if(chatInput.style.display === "none") topContainer.style.display = "none"; 
            }, 5000);
        }
    }

    function handleCommand(input) {
        const args = input.split(" ");
        const cmd = args[0].toLowerCase();
        const isAdmin = (playerRole === "DEV" || playerRole === "MOD");

        if(input === "/iamdeveloper block") {
            playerRole = "DEV";
            localStorage.setItem("playerRole", "DEV");
            addLog("System", "Akses Developer RGB Aktif!", "#00ffff");
            return;
        }

        switch(cmd) {
            case "/gm":
                if(!isAdmin) return addLog("System", "Akses Ditolak!", "red");
                globalBar.innerText = "GLOBAL: " + args.slice(1).join(" ");
                addLog("GLOBAL", args.slice(1).join(" "), "#ffd700");
                break;
            case "/name":
                if(!isAdmin) return addLog("System", "Akses Ditolak!", "red");
                playerName = args.slice(1).join(" ");
                addLog("System", "Nama berubah.", "lime");
                break;
            case "/ghost":
                if(!isAdmin) return addLog("System", "Akses Ditolak!", "red");
                ghostMode = !ghostMode;
                addLog("System", "Ghost Mode: " + (ghostMode ? "ON" : "OFF"), "yellow");
                break;
            case "/kill":
                player.x = 100; player.y = 100; player.vy = 0;
                addLog("System", "Respawned.", "red");
                break;
            default:
                addLog(playerName, input, (playerRole === "DEV" ? "#00ffff" : "white"));
        }
    }

    window.onkeydown = (e) => {
        if(!gameStarted) return;
        if(e.code === "Enter") {
            if(chatInput.style.display === "none") toggleChat(true);
            else {
                if(chatInput.value.trim()) handleCommand(chatInput.value);
                chatInput.value = "";
                toggleChat(false);
            }
        }
        if(chatInput.style.display === "none") keys[e.code] = true;
    };
    window.onkeyup = (e) => keys[e.code] = false;

    function update() {
        if(!gameStarted || chatInput.style.display === "block") return;
        if(keys["KeyA"]) player.x -= player.speed;
        if(keys["KeyD"]) player.x += player.speed;
        if(ghostMode) {
            if(keys["KeyW"]) player.y -= player.speed;
            if(keys["KeyS"]) player.y += player.speed;
            player.vy = 0;
        } else {
            player.vy += 0.6; player.y += player.vy;
            if(player.y > canvas.height - 140) {
                player.y = canvas.height - 140; player.vy = 0;
                if(keys["KeyW"]) player.vy = player.jumpPower;
            }
        }
    }

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(!gameStarted) { requestAnimationFrame(draw); return; }
        update();

        // Tanah
        ctx.fillStyle = "#8B4513";
        ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

        // Player Shadow (Ghost Mode)
        ctx.globalAlpha = ghostMode ? 0.5 : 1.0;
        ctx.fillStyle = "#FFD700";
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.globalAlpha = 1.0;

        // Label Nama & RGB
        if(playerRole === "DEV") {
            hue = (hue + 2) % 360;
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
        } else { ctx.fillStyle = "white"; }
        ctx.font = "bold 16px Arial"; ctx.textAlign = "center";
        ctx.fillText(`[${playerRole}] ${playerName}`, player.x + 15, player.y - 10);

        requestAnimationFrame(draw);
    }

    window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    draw();
</script>
</body>
</html>
